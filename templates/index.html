<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regionais Atendidas</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        button {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1>Regionais Atendidas</h1>

    <!-- Formulário para Adicionar Nova Loja -->
    <h2>Adicionar Nova Loja</h2>
    <form id="formAdicionar">
        <input type="text" id="regiao" placeholder="Região" required>
        <input type="text" id="loja" placeholder="Loja" required>
        <input type="text" id="nome" placeholder="Nome da Loja" required>
        <input type="text" id="pdv" placeholder="PDV" required>
        <input type="text" id="operador" placeholder="Operador" required>
        <button type="submit">Adicionar</button>
    </form>

    <!-- Tabela de Lojas -->
    <h2>Lojas Cadastradas</h2>
    <table id="tabelaLojas">
        <thead>
            <tr>
                <th>Região</th>
                <th>Loja</th>
                <th>Nome</th>
                <th>PDV</th>
                <th>Operador</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for index, row in df.iterrows() %}
            <tr>
                <td>{{ row["Região"] }}</td>
                <td>{{ row["Loja"] }}</td>
                <td>{{ row["Nome"] }}</td>
                <td>{{ row["PDV"] }}</td>
                <td>{{ row["Operador"] }}</td>
                <td>
                    <button onclick="editarLoja('{{ row['Loja'] }}')">Editar</button>
                    <button onclick="excluirLoja('{{ row['Loja'] }}')">Excluir</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Scripts JavaScript -->
    <script>
        // Adicionar nova loja
        $("#formAdicionar").submit(function (e) {
            e.preventDefault();
            const data = {
                regiao: $("#regiao").val(),
                loja: $("#loja").val(),
                nome: $("#nome").val(),
                pdv: $("#pdv").val(),
                operador: $("#operador").val(),
            };

            $.ajax({
                url: "/adicionar",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (response) {
                    alert(response.message);
                    location.reload();
                },
                error: function () {
                    alert("Erro ao adicionar a loja.");
                },
            });
        });

        // Excluir loja
        function excluirLoja(loja) {
            const data = { loja: loja };
            $.ajax({
                url: "/excluir",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (response) {
                    alert(response.message);
                    location.reload();
                },
                error: function () {
                    alert("Erro ao excluir a loja.");
                },
            });
        }

        // Editar loja
        function editarLoja(loja) {
            const novaRegiao = prompt("Nova Região:");
            const novoNome = prompt("Novo Nome:");
            const novoPDV = prompt("Novo PDV:");
            const novoOperador = prompt("Novo Operador:");

            if (novaRegiao && novoNome && novoPDV && novoOperador) {
                const data = {
                    loja: loja,
                    regiao: novaRegiao,
                    nome: novoNome,
                    pdv: novoPDV,
                    operador: novoOperador,
                };

                $.ajax({
                    url: "/editar",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function () {
                        alert("Erro ao editar a loja.");
                    },
                });
            }
        }
    </script>
</body>
</html>
